# 2023/05/13

◆ C언어의 컴파일 과정

C언어의 컴파일 과정은 크게
전처리기 / 컴파일러 / 어셈블러 / 링커의 단계를 거친다

○ 전처리기
전처리기를 거치게 되면 전처리를 거치게 된 결과물이 나오고 확장자는 보통 i로 표시한다

■ 전처리 과정이란

본격적으로 컴파일하기 전에 처리할 작업들
외부에 선언된 다양한 소스 코드, 라이브러리를 포함 ( #include )
프로그래밍의 편의를 위해 작성된 매크로 변환 ( #define )
컴파일할 영역 명시 ( #if, #ifdef ...)

■ 컴파일 과정이란

전처리가 완료 되어도, 여전히 소스 코드이다
전처리 완료된 소스 코드를 어셈블리어로 변환해주는 과정

■ 어셈블 과정이란

컴파일 과정에서 어셈블리어로 변환한 코드를 기계어로 변환
목적 코드를 포함하는 목적 파일이 됨
기계어로 변환하였기 때문에 그대로 실행하면 되지 않는가? 라고 생각되지만, 목적 파일과 실행 파일은 다르다
목적 파일은 링킹을 거친 이후에 실행 파일이 된다

■ 링커 과정이란

각기 다른 목적 코드들을 하나의 실행 파일로 연결시켜주는 작업
이 과정을 거치면 실행 파일이 완성된다



◆ CPU의 내부 구성

○ ALU와 제어장치
앞부분에서 ALU는 계산을 담당하는 장치, 제어장치는 제어 신호를 발생시키고 명령어를 해석하는 장치라고 배웠다
추가적으로 ALU와 제어장치가 어떤 정보들을 받아들이고 내보내는지 알아보겠다

■ ALU
계산에는 계산할 숫자, 계산 방식이 필요하고, 계산 결과가 생성된다

ALU의 계산에 필요한 값은 레지스터에서 받아오며
계산 방식, 더하기인지 빼기인지 등은 제어장치에서 보내는 제어 신호를 받아 판단한다

이렇게 받아들인 정보로 연산을 수행하고, 그 결과값을 다시 레지스터에 담아둔다

ALU에서 나오는 정보중에 플래그 라는 것이 있는데
숫자의 양수, 음수를 판단할 때, 이 플래그가 쓰인다고 간단하게 배웠었다
다만 여기에서 조금 더 들어가자면 ALU에서 연산 후
연산한 값이 양수인지, 음수인지 표시하는 플래그라는 값을 플래그 레지스터라는 특수한 레지스터에 저장한다
또한 연산 결과가 값을 담을 레지스터에 비해 너무 크다고 판단하면 이 또한 플래그에 담기게 되고, 오버플로우가 났다고 한다

플래그에는 크게 6종류가 있는데

부호 플래그 - 연산한 결과의 부호를 나타낸다 ( 1일 경우 음수, 0일 경우 양수)
제로 플래그 - 연산 결과가 0인지 여부를 나타낸다 ( 1일 경우 0, 0일 경우 0이 아님 )
캐리 플래그 - 연산 결과, 올림수나 빌림수가 발생했는지를 나타낸다 ( 1일 경우 발생, 0일 경우 발생하지 않음 )
오버플로우 플래그 - 오버플로우가 발생했는지를 나타낸다 ( 1일 경우 발생 , 0일 경우 발생하지 않음)
인터럽트 플래그 - 인터럽트가 가능한지를 나타낸다 ( 1일 경우 가능, 0일 경우 불가능 )
슈퍼바이저 플래그 - 커널 모드로 실행 중인지, 사용자 모드로 실행 중인지를 나타낸다 ( 1일 경우 커널 모드 , 0일 경우 사용자 모드 )

이런 역할을 하는 플래그들이 있다 라는 것만 알아보고, 인터럽트 플래그와 슈퍼바이저 플래그는 나중에 자세히 알아보도록 하겠다

ALU 내부에는 다양한 회로들이 있는데
덧셈을 위한 가산기, 뺼셈을 위한 보수기, 비트를 왼쪽, 오른쪽으로 미는 연산을 해주는 시프터, 오버플로우 검출을 해주는 오버플로우 검출기 등이 있지만, 이런 게 있다 라고 알아두기만 하고 회로에 대해서는 나중에 다뤄보기로 하였다


■ 제어 장치
1. 제어 장치가 받아들이는 정보

클럭
컴퓨터의 모든 부품을 일정 주기에 맞춰서 일사분란하게 움직일 수 있게 하는 시간 단위이다

해석할 명령어
제어 장치가 명령어를 받아 제어 신호를 내보낼 때, 해석할 명령어는 명령어 레지스터라는 특수한 레지스터에 저장되어 있다

플래그
ALU가 연산을 하고 나온 부가적인 결과물인데, 명령어를 해석하는 과정에서 이런 부가 정보들이 필요하기 때문에 플래그 값 또한 받아온다

제어 신호
제어 장치가 제어 신호를 발생시킨다고는 하지만, 제어 장치 뿐만이 아닌, 다른 입 출력 장치들도 제어 신호를 발생시킬 수 있다
외부로부터 제어 신호가 발생되고 그 신호가 CPU 안에 들어오게 된다면, 이 신호가 어떤 신호인지를 받아들이게 된다

2. 제어 장치가 내보내는 정보
제어 장치가 내보내는 신호에는

▲ CPU 내부에 전달하는 신호
레지스터에 전달하는 신호 - 레지스터 간의 정보 이동, 값 저장, 행동을 해라 등의 신호
ALU에 전달하는 신호 - 수행할 연산의 종류 지시

▲ CPU 외부에 전달하는 신호
메모리에 전달하는 신호 - 메모리 읽기, 쓰기
입출력장치에 전달하는 신호 - 입출력장치 읽기, 쓰기, 테스트

